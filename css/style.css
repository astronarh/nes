body {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background-color: #222;
    color: #eee;
    font-family: sans-serif;
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    overflow-y: auto;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

h1 {
    margin-top: 20px;
    margin-bottom: 10px;
    flex-shrink: 0;
}

canvas {
    border: 2px solid #555;
    background-color: black;
    image-rendering: pixelated;
    width: 512px;
    height: 480px;
    max-width: 95vw;
    max-height: calc(100vh - 200px);
    z-index: 1;
    margin-bottom: 20px;
    display: block;
    flex-shrink: 1;
    flex-grow: 1;
}

#controls {
    margin-top: 20px;
    margin-bottom: 20px;
    text-align: center;
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 700px;
}

#controls p {
    margin: 10px 0;
}

/* Стили для кастомной кнопки загрузки ROM */
.file-input-wrapper {
    position: relative;
    overflow: hidden;
    display: inline-block;
    margin-bottom: 10px;
}

.file-input-wrapper input[type="file"] {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
    z-index: 1;
}

.custom-file-button {
    display: inline-block;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    transition: background-color 0.2s ease;
    text-align: center;
    line-height: normal;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

.custom-file-button:hover {
    background-color: #0056b3;
}

/* Стили для остальных кнопок */
button {
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    margin: 5px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    transition: background-color 0.2s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

button:hover {
    background-color: #0056b3;
}

/* Новые стили для размещения контроллеров */
#touch-controls {
    display: flex; /* Flexbox для размещения D-pad и правой группы кнопок */
    justify-content: space-between; /* D-pad слева, кнопки справа */
    align-items: center; /* Выравниваем по центру по вертикали */
    width: 100%;
    margin-top: 20px;
    padding: 10px;
    box-sizing: border-box;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
    gap: 10px; /* Отступ между группами кнопок */
}

#dpad {
    display: grid;
    grid-template-areas:
        ". up ."
        "left center right"
        ". down .";
    grid-template-columns: repeat(3, 60px);
    grid-template-rows: repeat(3, 60px);
    gap: 0px;
    width: 180px;
    height: 180px;
    position: relative;
    pointer-events: auto;
    margin-right: auto; /* Отталкивает правую группу кнопок вправо */
}

.dpad-btn {
    width: 100%;
    height: 100%;
    border-radius: 0;
    background-color: #444;
    border: 2px solid #666;
    color: white;
    font-size: 1.2em;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    touch-action: manipulation;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease;
}

.dpad-btn:active {
    background-color: #666;
    box-shadow: none;
    transform: translateY(2px);
}

#dpad-up {
    grid-area: up;
    border-bottom: none;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}
#dpad-left {
    grid-area: left;
    border-right: none;
    border-top-left-radius: 10px;
    border-bottom-left-radius: 10px;
}
#dpad-right {
    grid-area: right;
    border-left: none;
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
}
#dpad-down {
    grid-area: down;
    border-top: none;
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
}

#dpad-up::after { content: '▲'; }
#dpad-left::after { content: '◀'; }
#dpad-right::after { content: '▶'; }
#dpad-down::after { content: '▼'; }


/* Стилизация правой группы кнопок с использованием Grid для точного позиционирования */
#right-side-buttons-grid {
    display: grid;
    /* Определяем 3 колонки:
       Первая и третья - для смещения кнопок B и A
       Вторая - для пространства между B и A, и для размещения Select/Start
    */
    grid-template-columns: 1fr auto 1fr; /* Гибкая левая, авто для кнопок, гибкая правая */
    grid-template-rows: auto auto; /* Две строки: A/B сверху, Select/Start снизу */
    gap: 10px 10px; /* Вертикальный и горизонтальный отступ между ячейками */
    margin-left: auto; /* Отталкивает всю сетку вправо */
    align-items: center; /* Центрируем содержимое ячеек по вертикали */
    justify-items: center; /* Центрируем содержимое ячеек по горизонтали */
    width: 250px; /* Примерная общая ширина для этой группы кнопок */
    height: 180px; /* Чтобы по высоте соответствовало D-pad */
}

#btn-b {
    grid-column: 2 / 3; /* Размещаем кнопку B во второй колонке */
    grid-row: 1 / 2; /* В первой строке */
    width: 70px; /* Размер кнопки B */
    height: 70px;
    border-radius: 50%; /* Круглая */
    background-color: #e74c3c; /* Красная */
    border: 3px solid #c0392b;
    font-size: 1.3em;
    align-self: end; /* Прижимает кнопку B к нижнему краю ячейки для диагонального эффекта */
    margin-right: -10px; /* Небольшое смещение вправо, чтобы A была дальше */
    z-index: 1; /* Чтобы A была поверх B при пересечении */
}

#btn-a {
    grid-column: 3 / 4; /* Размещаем кнопку A в третьей колонке */
    grid-row: 1 / 2; /* В первой строке */
    width: 80px; /* Размер кнопки A (чуть больше B) */
    height: 80px;
    border-radius: 50%; /* Круглая */
    background-color: #e74c3c; /* Красная */
    border: 3px solid #c0392b;
    font-size: 1.3em;
    align-self: start; /* Прижимает кнопку A к верхнему краю ячейки для диагонального эффекта */
    margin-left: -10px; /* Небольшое смещение влево, чтобы A была дальше */
    z-index: 2; /* A поверх B */
}

/* Стили для кнопок Select и Start */
#btn-select {
    grid-column: 1 / 3; /* Занимает первые две колонки */
    grid-row: 2 / 3; /* Во второй строке */
    width: 100px; /* Увеличим ширину, чтобы вместить текст */
    height: 40px;
    border-radius: 10px;
    background-color: #3498db; /* Синяя */
    border: 2px solid #2980b9;
    font-size: 0.9em;
    justify-self: end; /* Выравнивание к левому краю, чтобы Start был справа */
}

#btn-start {
    grid-column: 3 / 4; /* Занимает третью колонку */
    grid-row: 2 / 3; /* Во второй строке */
    width: 100px; /* Увеличим ширину, чтобы вместить текст */
    height: 40px;
    border-radius: 10px;
    background-color: #3498db; /* Синяя */
    border: 2px solid #2980b9;
    font-size: 0.9em;
    justify-self: start; /* Выравнивание к правому краю, чтобы Select был слева */
}


#btn-select:active, #btn-start:active {
    background-color: #2980b9;
}


/* Медиа-запросы для адаптации на очень маленьких экранах */
@media (max-width: 480px) {
    #touch-controls {
        flex-direction: column; /* На маленьких экранах снова располагаем всё вертикально */
        align-items: center; /* Центрируем по горизонтали */
        padding: 10px;
        gap: 20px; /* Увеличим отступ между D-pad и кнопками на мобильных */
    }
    #dpad {
        margin: 0; /* Сброс margin-right: auto для мобильных */
    }
    #right-side-buttons-grid {
        margin: 0; /* Сброс margin-left: auto для мобильных */
        align-items: center; /* Центрируем кнопки действий */
        justify-content: center; /* Центрируем сетку */
        width: 100%; /* Занимаем всю доступную ширину */
        /* На мобильных, A/B и Select/Start могут быть центрированы или в две колонки */
        grid-template-columns: 1fr 1fr; /* Две колонки для кнопок */
        grid-template-rows: auto auto auto; /* Одна строка для B, одна для A, одна для Select/Start */
        gap: 10px; /* Отступ между элементами сетки */
        padding: 0 10px; /* Небольшой горизонтальный отступ */
    }
    #btn-b {
        grid-column: 1 / 2; /* B в первой колонке */
        grid-row: 1 / 2;
        align-self: center; /* Центрируем в ячейке */
        margin-right: 0; /* Убираем смещение */
    }
    #btn-a {
        grid-column: 2 / 3; /* A во второй колонке */
        grid-row: 1 / 2;
        align-self: center; /* Центрируем в ячейке */
        margin-left: 0; /* Убираем смещение */
    }
    #btn-select {
        grid-column: 1 / 2; /* Select в первой колонке */
        grid-row: 2 / 3; /* Во второй строке */
        justify-self: center; /* Центрируем */
    }
    #btn-start {
        grid-column: 2 / 3; /* Start во второй колонке */
        grid-row: 2 / 3; /* Во второй строке */
        justify-self: center; /* Центрируем */
    }
    canvas {
        max-height: calc(100vh - 250px);
    }
}